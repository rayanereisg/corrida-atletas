#!/usr/bin/env bash
# Hook local para validar mensagem de commit antes de concluir
MSG_FILE="$1"
if [ -z "$MSG_FILE" ]; then
  exit 0
fi

HEADLINE=$(sed -n '1p' "$MSG_FILE")
PORT_KEYWORDS='ã|á|é|í|ó|ú|ç|ão|ões|adicionar|adiciona|adicionando|adicionado|corrigir|corrigido|atualizar|atualizado|refatorar|refatorado|melhorar|remover|teste|testes|estilos|valida|validar|versão|tempo|salvar'

if ! echo "$HEADLINE" | grep -E -q '^(feat|fix|docs|style|refactor|test|chore|perf)(\(.+\))?: .+'; then
  echo "Mensagem de commit inválida: use o formato 'tipo: descrição' (ex: feat: adicionar validação)." >&2
  exit 1
fi

DESC=$(echo "$HEADLINE" | sed -E 's/^[^:]+:[[:space:]]*//')
if ! echo "$DESC" | grep -Ei -q "$PORT_KEYWORDS"; then
  echo "Mensagem de commit deve estar em português (ex: 'feat: adicionar validação')." >&2
  exit 1
fi

exit 0